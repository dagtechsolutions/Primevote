<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PrimeVote</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="primevote.css">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<header>
  <h1>PrimeVote</h1>
  <div id="vote-status" class="mt-2 text-lg"></div>
</header>
<main>
  <!-- Login Section -->
  <section id="login-section" class="bg-white p-6 rounded-lg shadow mb-10">
    <h2>Login</h2>
    <form id="admin-login-form" class="mb-3 flex items-center space-x-2">
      <input type="password" id="admin-password-input" placeholder="Admin password" required>
      <button type="submit">Admin Login</button>
    </form>
    <form id="voter-login-form" class="flex items-center space-x-2">
      <input type="text" id="voter-id-input" placeholder="Enter your Voter ID" required>
      <button type="submit">Voter Login</button>
    </form>
    <div id="login-status" class="text-red-600 mt-2"></div>
  </section>

  <!-- Admin Section -->
  <section id="admin-section" class="bg-white p-6 rounded-lg shadow mb-10 hidden">
    <h2>Admin Panel</h2>
    <div class="mb-4">
      <button id="toggle-voting-btn">Open Voting</button>
      <span id="current-voting-state" class="font-semibold"></span>
    </div>
    <!-- ...rest of admin panel... -->
    <button id="admin-logout-btn" class="mt-4">Logout</button>
  </section>

  <!-- Voter Section -->
  <section id="voter-section" class="bg-white p-6 rounded-lg shadow mb-10 hidden">
    <h2>Voter Voting</h2>
    <div id="voter-status" class="mb-5"></div>
    <form id="voting-panel" class="hidden">
      <div id="positions-list"></div>
      <button type="submit">Submit Votes</button>
    </form>
    <button id="voter-logout-btn" class="mt-4">Logout</button>
  </section>
</main>
<script>
document.addEventListener('DOMContentLoaded', function() {
  let isAdmin = false;
  let voterId = '';

  // Login logic
  document.getElementById('admin-login-form').onsubmit = (e) => {
    e.preventDefault();
    const pwd = document.getElementById('admin-password-input').value;
    if (pwd === "admin2024") {
      isAdmin = true;
      voterId = '';
      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('admin-section').classList.remove('hidden');
      document.getElementById('voter-section').classList.add('hidden');
      refreshVotingState();
    } else {
      document.getElementById('login-status').textContent = "Invalid admin password!";
    }
  };

  document.getElementById('voter-login-form').onsubmit = async (e) => {
    e.preventDefault();
    voterId = document.getElementById('voter-id-input').value.trim();
    if (!voterId) return;
    // Insert your voter authentication logic here (e.g., fetch to /api/voter-auth)
    isAdmin = false;
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('admin-section').classList.add('hidden');
    document.getElementById('voter-section').classList.remove('hidden');
    document.getElementById('login-status').textContent = '';
  };

  document.getElementById('admin-logout-btn').onclick = () => {
    isAdmin = false;
    document.getElementById('login-section').classList.remove('hidden');
    document.getElementById('admin-section').classList.add('hidden');
  };
  document.getElementById('voter-logout-btn').onclick = () => {
    voterId = '';
    document.getElementById('login-section').classList.remove('hidden');
    document.getElementById('voter-section').classList.add('hidden');
  };

  // Voting toggle logic
  async function refreshVotingState() {
    try {
      const res = await fetch('/api/voting-state').then(r=>r.json());
      document.getElementById('current-voting-state').textContent = res && res.votingOpen ? 'Voting is OPEN' : 'Voting is CLOSED';
      document.getElementById('toggle-voting-btn').textContent = res && res.votingOpen ? 'Close Voting' : 'Open Voting';
      document.getElementById('vote-status').textContent = res && res.votingOpen ? 'Voting is OPEN' : 'Voting is CLOSED';
    } catch {
      document.getElementById('current-voting-state').textContent = "Voting state unavailable";
      document.getElementById('vote-status').textContent = "Voting state unavailable";
    }
  }
  document.getElementById('toggle-voting-btn').onclick = async () => {
    try {
      const state = await fetch('/api/voting-state').then(r=>r.json());
      await fetch('/api/voting-state', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({open: !(state && state.votingOpen)})
      });
      refreshVotingState();
    } catch {
      alert("Unable to toggle voting state.");
    }
  };

});
</script>
</body>
</html>
